# Bitrix24 + Google Gemini AI Integration

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Gemini –≤ –∫–∞—á–µ—Å—Ç–≤–µ AI-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è Bitrix24.

## üéØ –ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç?

–≠—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Google Gemini** –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –¥–ª—è:
- **CoPilot –≤ Bitrix24** - –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ç–µ–∫—Å—Ç–∞–º
- **–ó–∞–¥–∞—á–∏** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏–π –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- **CRM** - —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Å–µ–º –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
- **–ß–∞—Ç—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- Google Gemini API Key ([–ø–æ–ª—É—á–∏—Ç—å –∑–¥–µ—Å—å](https://makersuite.google.com/app/apikey))
- Bitrix24 –∞–∫–∫–∞—É–Ω—Ç —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—É–±–ª–∏—á–Ω—ã–π URL –¥–ª—è –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∏–ª–∏ ngrok –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd bitrix24-gemini-ai
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
# Google Gemini API Key
# –ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ https://makersuite.google.com/app/apikey
GEMINI_API_KEY=your_actual_gemini_api_key

# Server Configuration
PORT=3000
HOST=0.0.0.0

# Bitrix24 Webhook URL
# –§–æ—Ä–º–∞—Ç: https://your-domain.bitrix24.ru/rest/1/webhook_code/
BITRIX24_WEBHOOK_URL=https://your-domain.bitrix24.ru/rest/1/xxxxx/
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ Gemini API Key

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://makersuite.google.com/app/apikey
2. –í–æ–π–¥–∏—Ç–µ —Å Google –∞–∫–∫–∞—É–Ω—Ç–æ–º
3. –ù–∞–∂–º–∏—Ç–µ "Create API Key"
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á –≤ `.env` —Ñ–∞–π–ª

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ Bitrix24 Webhook

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à Bitrix24
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º ‚Üí –î—Ä—É–≥–æ–µ ‚Üí –í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫**
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –≤–µ–±—Ö—É–∫ —Å –ø—Ä–∞–≤–∞–º–∏:
   - `ai_admin` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –≤–µ–±—Ö—É–∫–∞ –≤ `.env` —Ñ–∞–π–ª

### 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
npm run dev

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm start
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É Gemini:

```bash
curl -X POST http://localhost:3000/test \
  -H "Content-Type: application/json" \
  -d '{"message": "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"}'
```

### 7. –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

Bitrix24 –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **ngrok**:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
brew install ngrok

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å
ngrok http 3000
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok.io`)

### 8. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Bitrix24

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ URL –Ω–∞ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π URL (ngrok –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω)
node register-ai.js https://abc123.ngrok.io
```

–ò–ª–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

```bash
node register-ai.js https://your-server.com
```

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```bash
node list-ai.js
```

## üì° API Endpoints

### `GET /`
Health check endpoint

```bash
curl http://localhost:3000/
```

### `POST /ai/completions`
–û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è Bitrix24

**Request format:**
```json
{
  "prompt": "–ù–∞–ø–∏—à–∏ –ø–∏—Å—å–º–æ –∫–ª–∏–µ–Ω—Ç—É",
  "payload_role": "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä",
  "context": [],
  "temperature": 0.7,
  "max_tokens": 2048
}
```

**Response format:**
```json
{
  "result": "OK",
  "choices": [{
    "message": {
      "role": "assistant",
      "content": "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç..."
    }
  }]
}
```

### `POST /test`
–¢–µ—Å—Ç–æ–≤—ã–π endpoint

```bash
curl -X POST http://localhost:3000/test \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello!"}'
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AI-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `register-ai.js`:

```javascript
{
  name: 'Google Gemini',          // –ù–∞–∑–≤–∞–Ω–∏–µ –≤ UI Bitrix24
  code: 'google_gemini',          // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
  category: 'text',               // text | image | audio
  completions_url: 'https://...',  // URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
  settings: {
    code_alias: 'ChatGPT',        // –¢–∏–ø –º–æ–¥–µ–ª–∏
    model_context_type: 'token',  // token | symbol
    model_context_limit: 32768    // –õ–∏–º–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  }
}
```

## üé® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Bitrix24

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

1. **–í CoPilot:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤ B24
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É CoPilot
   - –í—ã–±–µ—Ä–∏—Ç–µ "Google Gemini" –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤

2. **–í –∑–∞–¥–∞—á–∞—Ö:**
   - –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CoPilot –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
   - Gemini –ø–æ–º–æ–∂–µ—Ç —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É

3. **–í CRM:**
   - –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
   - –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏–π —Å–¥–µ–ª–æ–∫

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "GEMINI_API_KEY not configured"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`

### –û—à–∏–±–∫–∞: "BITRIX24_WEBHOOK_URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
- –°–æ–∑–¥–∞–π—Ç–µ –≤–µ–±—Ö—É–∫ –≤ Bitrix24
- –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞ `ai_admin`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç URL (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `/`)

### Bitrix24 –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ngrok —Ç—É–Ω–Ω–µ–ª—å (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –∏ –ø–æ—Ä—Ç—ã

### –û—Ç–≤–µ—Ç –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Gemini API —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API –∫–ª—é—á–∞

## üìä –õ–æ–≥–∏

–°–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```
[2024-01-15T10:30:00.000Z] POST /ai/completions
Received request from Bitrix24: {...}
Sending to Gemini: User: –ù–∞–ø–∏—à–∏...
Gemini response: –£–≤–∞–∂–∞–µ–º—ã–π –∫–ª–∏–µ–Ω—Ç...
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚ö†Ô∏è –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª
- üîí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- üõ°Ô∏è –î–æ–±–∞–≤—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- üìù –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ API –∫–ª—é—á–∏

## üöÄ –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

### –í–∞—Ä–∏–∞–Ω—Ç 1: VPS/VDS

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js –∏ PM2
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ PM2:

```bash
pm2 start server.js --name bitrix24-gemini
pm2 save
pm2 startup
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Docker

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --production
COPY . .
EXPOSE 3000
CMD ["node", "server.js"]
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Cloud (Heroku, Railway, etc.)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Bitrix24 REST API - AI](https://apidocs.bitrix24.com/api-reference/ai/index.html)
- [Google Gemini API](https://ai.google.dev/docs)
- [Bitrix24 Developer Hub](https://dev.bitrix24.com/)

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
3. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –∫–ª—é—á–µ–π
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –≤–µ–±—Ö—É–∫–∞ –≤ Bitrix24

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
